<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>التقويم الدراسي الأسبوعي</title>

<style>
/* =================== STYLE =================== */
:root{
  --bg:#0b1020;--card:#111a33;--text:#e8eeff;--muted:#a9b6e6;
  --line:rgba(255,255,255,.10);--friSat:rgba(255,209,102,.18);
  --accent:#7c5cff;--ok:#2fe7a4;--bad:#ff5c7a;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Tahoma,Arial;
  background:linear-gradient(135deg,#1b2a6b,#0b1020);
  color:var(--text)
}
.wrap{max-width:1250px;margin:auto;padding:18px}
.topbar{
  display:flex;justify-content:space-between;align-items:center;gap:10px;
  background:rgba(255,255,255,.06);border:1px solid var(--line);
  border-radius:16px;padding:14px
}
.brand{display:flex;gap:10px;align-items:center}
.logo{width:40px;height:40px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent),#35c6ff)}
.actions{display:flex;gap:8px;flex-wrap:wrap}
button{
  border:1px solid var(--line);background:rgba(255,255,255,.08);
  color:#fff;padding:10px 14px;border-radius:12px;
  cursor:pointer;font-weight:700
}
button.primary{background:rgba(124,92,255,.35)}
button.danger{background:rgba(255,92,122,.25)}
.grid{margin-top:14px;display:grid;gap:14px}
.weekCard{border:1px solid var(--line);border-radius:16px;overflow:hidden}
.weekHead{padding:12px;background:rgba(0,0,0,.2)}
.table{display:grid;grid-template-columns:repeat(7,1fr)}
.th,.td{padding:10px;border-left:1px solid var(--line);border-bottom:1px solid var(--line)}
.th{font-weight:900;text-align:center;background:rgba(255,255,255,.05)}
.th.friSat,.td.friSat{background:var(--friSat)}
.events{margin-top:6px;display:flex;flex-direction:column;gap:6px}
.event{padding:6px 8px;border-radius:8px;
  background:rgba(255,255,255,.1);font-size:12px;
  display:flex;justify-content:space-between;gap:6px}
.badge{font-size:10px;border:1px solid var(--line);
  padding:2px 6px;border-radius:999px}
.modalBack{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  display:none;align-items:center;justify-content:center;z-index:50
}
.modal{background:#0f1730;border-radius:16px;
  width:min(420px,95%);border:1px solid var(--line)}
.modalHead,.modalFoot{padding:12px;border-bottom:1px solid var(--line)}
.modalFoot{border:none;display:flex;gap:8px;justify-content:flex-end}
.modalBody{padding:12px;display:grid;gap:10px}
input,textarea{
  width:100%;padding:10px;border-radius:10px;
  border:1px solid var(--line);background:#00000033;color:#fff
}
</style>
</head>

<body>
<div class="wrap">

<!-- =================== TOP BAR =================== -->
<div class="topbar">
  <div class="brand">
    <div class="logo"></div>
    <div>
      <b>التقويم الدراسي الأسبوعي</b><br>
      <small>Firebase + Firestore</small>
    </div>
  </div>
  <div class="actions">
    <span id="roleText">زائر</span>
    <button id="btnAuth" class="primary">دخول</button>
    <button id="btnLogout" style="display:none">خروج</button>
    <button id="btnAdmin" style="display:none">لوحة المدير</button>
    <button id="btnMy" style="display:none">حدث خاص</button>
  </div>
</div>

<div id="weeksGrid" class="grid"></div>
</div>

<!-- =================== LOGIN MODAL =================== -->
<div class="modalBack" id="authBack">
<div class="modal">
<div class="modalHead"><b>تسجيل الدخول</b></div>
<div class="modalBody">
  <div style="color:#ffb">⚠️ التسجيل الجديد مقفول – الحسابات ينشئها المدير فقط</div>
  <input id="authEmail" type="email" placeholder="البريد الإلكتروني">
  <input id="authPass" type="password" placeholder="كلمة المرور">
</div>
<div class="modalFoot">
  <button id="btnForgot">نسيت كلمة المرور؟</button>
  <button id="btnSignin" class="primary">دخول</button>
</div>
</div>
</div>

<script type="module">
/* =================== FIREBASE =================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getAuth,onAuthStateChanged,
  signInWithEmailAndPassword,signOut,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import {
  getFirestore,collection,addDoc,deleteDoc,
  onSnapshot,query,orderBy
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PUT_HERE",
  authDomain: "PUT_HERE",
  projectId: "PUT_HERE",
  storageBucket: "PUT_HERE",
  messagingSenderId: "PUT_HERE",
  appId: "PUT_HERE"
};

const ADMIN_EMAILS = ["ensancom@gmail.com"];

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* =================== ELEMENTS =================== */
const authBack = document.getElementById("authBack");
const btnAuth = document.getElementById("btnAuth");
const btnSignin = document.getElementById("btnSignin");
const btnForgot = document.getElementById("btnForgot");
const btnLogout = document.getElementById("btnLogout");
const roleText = document.getElementById("roleText");
const authEmail = document.getElementById("authEmail");
const authPass = document.getElementById("authPass");

/* =================== LOGIN =================== */
btnAuth.onclick = ()=> authBack.style.display="flex";
btnSignin.onclick = async ()=>{
  await signInWithEmailAndPassword(auth,authEmail.value,authPass.value);
  authBack.style.display="none";
};

btnForgot.onclick = async ()=>{
  if(!authEmail.value) return alert("اكتب البريد أولاً");
  await sendPasswordResetEmail(auth,authEmail.value);
  alert("تم إرسال رابط إعادة التعيين إلى بريدك");
};

btnLogout.onclick = ()=> signOut(auth);

/* =================== AUTH STATE =================== */
onAuthStateChanged(auth,user=>{
  if(!user){
    roleText.textContent="زائر";
    btnLogout.style.display="none";
    return;
  }
  roleText.textContent = ADMIN_EMAILS.includes(user.email) ? "مدير" : "مستخدم";
  btnLogout.style.display="inline-block";
});

/* =================== END =================== */
</script>
</body>
</html>
